<!DOCTYPE html>
<!--
  ~ Copyright (c) 2016. Universidad Politecnica de Madrid
  ~
  ~ @author Badenes Olmedo, Carlos <cbadenes@fi.upm.es>
  ~
  -->

<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="DrInventor Repository">
    <meta name="author" content="cbadenes">

    <title>drinventor repository</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/sb-admin.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

      <!-- Navigation -->
      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">DrInventor Repository</a>
          </div>
          <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
          <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul class="nav navbar-nav side-nav">
                  <!--<li class="active">
                      <a href="index.html"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
                  </li>-->
                  <li class="active">
                      <a href="javascript:;" data-toggle="collapse" data-target="#explore"><i class="fa fa-fw fa-search"></i> Explore <i class="fa fa-fw fa-caret-down"></i></a>
                      <ul id="explore">
                          <li>
                            <a href="ex-corpus.html"><i class="fa fa-copy"></i> Corpus</a>
                          </li>
                          <li>
                              <a href="ex-documents.html"><i class="fa fa-file-text-o"></i> Documents</a>
                          </li>
                          <li>
                              <a href="ex-topics.html"><i class="fa fa-tags"></i> Topics</a>
                          </li>
                          <li>
                              <a href="ex-terms.html"><i class="fa fa-comment-o"></i> Terms</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                      <a href="javascript:;" data-toggle="collapse" data-target="#discover"><i class="fa fa-fw fa-magic"></i> Discover <i class="fa fa-fw fa-caret-down"></i></a>
                      <ul id="discover">
                          <li>
                              <a href="dis-filter.html"><i class="fa fa-filter"></i> Filters</a>
                          </li>
                          <li>
                              <a href="dis-matches.html"><i class="fa fa-search-plus"></i> Matches</a>
                          </li>
                          <li>
                              <a href="dis-paths.html"><i class="fa fa-sitemap"></i> Paths</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </nav>

        <div id="page-wrapper">



            <div class="container-fluid" id="filter-panel">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">
                            Finding Matching Documents
                        </h1>
                        <ol class="breadcrumb">
                            <li>
                                <i class="fa fa-database"></i>  <a href="index.html">Repository</a>
                            </li>
                            <li class="active">
                                <i class="fa fa-search-plus"></i> Matches
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Page Explanation 
                <div class="row">
                    <div class="col-lg-12">
                        <ol class="breadcrumb">
                            <h4>Given an excerpt of plain text, DR Inventor platform is able to retrieve the most relevant scientific papers elaborating on similar topics so the user can get more insights about the initial research field expressed in the filter.</h4>
                        </ol>
                    </div>
                </div>-->



                <!-- /.row -->

                <div class="row">
                    <div class="col-lg-12">
                            <div class="panel panel-success">
                            <div class="panel-heading">
                                <h3 class="panel-title">Enter Textual Query</h3>
                            </div>
                            <div class="panel-body">
                                <div class="form-group-filterinput">
                                    <!-- <label>Text area</label> -->
                                    <textarea id="textarea-filter"class="form-control" rows="3" style="margin: 0px -0.5px 0px 0px; height: 100px;">vertices or pixel</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.row -->



                <div class="row">
                    <div class="col-lg-12">
                        <center style="margin-bottom: 20px">
                           <button id="resetFilter" type="button" class="btn btn-lg btn-default">
                            Reset

                            </button>
                           <button id="launchFilter" type="button" class="btn btn-lg btn-success"data-loading-text="<i class='fa fa-spinner fa-spin '></i> Retrieving Data...">
                           Match!
                           </button>
                        </center>
                    </div>
                </div>




                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-file fa-fw"></i> Items</h3>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover table-striped" id="tableFilterResult">
                                        <thead>
                                            <tr>
                                                <th>Resource</th>
                                                <th>Weight</th>
                                                <!-- / <th>Author/s</th> -->
                                            </tr>
                                        </thead>
                                        <tbody>
 
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.row -->

            </div>
        <!-- /#filter-panel-->


                <div class="panel panel-default">
                  <div class="panel-footer">
                    <table style="width:100%">
                      <tr>
                        <td><img src="images/logo_dri.png" width="33" height="33" alt="dr inventor"></td>
                        <td><center>This research project receives funding from the European Commission&#39;s Seventh Framework Programme.<br/>Activity ICT (FP7-ICT-2013.8.1), Grant agreement no: 611383</center></td>
                        <td><img src="images/euflag.jpg" width="33" height="33" alt="european"></td>
                      </tr>
                    </table>
                  </div>
                </div>
                <!-- /.row -->

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="js/plugins/morris/raphael.min.js"></script>
    <script src="js/plugins/morris/morris.min.js"></script>
    <script src="js/plugins/morris/morris-data.js"></script>

    <!-- SIGGRAPH Charts -->
    <script>
    

    var buttonResetFilter = document.getElementById('resetFilter');
    buttonResetFilter.addEventListener('click', function() {
        $('#textarea-filter').val('');
    }, false);


    var buttonLaunchFilter = document.getElementById('launchFilter');
    buttonLaunchFilter.addEventListener('click', function() {
        var DrInventorAPI = "http://drinventor.dia.fi.upm.es:80/api/0.2/filters";
        var myJSObject = new Object();
        myJSObject.content = $('#textarea-filter').val();

        var $this = $(this);
        $this.button('loading');

        $.ajax ({
            type: "POST",
            url: DrInventorAPI,
            dataType: "json",
            headers: {'Content-Type': 'application/json'},
            data: JSON.stringify(myJSObject)
        })
        .done(function (data) {
            $("#tableFilterResult tbody tr").remove();
            retrieveFilteredSimilarResources(data.uri);
            //retrieveFilteredSimilarParts(data.uri); 
            //retrieveFilteredSimilarDocuments(data.uri); 
 
        })
        .fail(function (data) {
           alert("Error: " + data); 
        });
    }, false);


    function retrieveFilteredSimilarResources (uri){
        while (uri.indexOf("/") !== -1) {
            uri = uri.substring(uri.indexOf("/")+1);
        }

        var DrInventorAPIsimilarFilters = "http://drinventor.dia.fi.upm.es:80/api/0.2/filters/"+uri+"/matches";

          $.getJSON( DrInventorAPIsimilarFilters)
            .done(function( data ) {
              $.each( data, function( i) {
                //$( "<img>" ).attr( "src", item.media.m ).appendTo( "#images" );
                printDocInTable(this.resource, this.weight);
              });
              $('#launchFilter').button('reset');
            });

    }

    function printDocInTable (uri, weight){
        var itemType  = "";
        var originalUri = uri;
        while (uri.indexOf("/") !== -1) {
            itemType = uri.substring(0, uri.indexOf("/"));
            uri = uri.substring(uri.indexOf("/")+1);
        }

        var DrInventorAPIdocs = "http://drinventor.dia.fi.upm.es:80/api/0.2/"+itemType+"/"+uri;

        $('#tableFilterResult > tbody:last-child').append("<tr><td><a target=\"_blank\" href=\""+DrInventorAPIdocs+"\">"+originalUri+"</a></td><td>"+weight+"</td></tr>");


        /*var DrInventorAPIdocs = "http://drinventor.dia.fi.upm.es:80/api/0.2/"+itemType+"/"+uri;

          $.getJSON( DrInventorAPIdocs)
            .done(function( data ) {
                $('#tableFilterResult > tbody:last-child').append("<tr><td>"+data.publishedOn+"</td><td><a target=\"_blank\" href=\""+DrInventorAPIdocs+"\">"+data.title+"</a></td><td>"+data.authoredBy+"</td></tr>");
            });*/

    }

    </script>
</body>

</html>
